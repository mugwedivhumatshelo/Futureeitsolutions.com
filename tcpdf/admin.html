<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard | Futuree IT Solutions</title>
<link rel="icon" href="img/hi (1).png" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
  /* Header styles */
  .main-header { background:#fff; border-bottom:1px solid #ccc; padding:10px 20px; position:sticky; top:0; z-index:999; }
  .nav-container { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
  .logo-title { display:flex; align-items:center; gap:10px; }
  .logo { height:45px; width:auto; }
  .site-title { font-size:1.4rem; font-weight:bold; color:#222; }
  .nav-links { display:flex; gap:20px; list-style:none; padding:0; margin:0; }
  .nav-links li a { text-decoration:none; color:#000; font-weight:600; transition:color 0.3s; }
  .nav-links li a:hover { color:#ff2e2e; }
  .menu-toggle { display:none; flex-direction:column; justify-content:space-between; width:25px; height:18px; background:none; border:none; cursor:pointer; padding:0; }
  .menu-toggle span { height:3px; width:100%; background:#ff2e2e; border-radius:2px; }
  @media(max-width:768px) {
    .nav-links { display:none; flex-direction:column; width:100%; background:#fff; position:absolute; top:65px; left:0; border-top:1px solid #ddd; }
    .nav-links.open { display:flex; }
    .menu-toggle { display:flex; }
  }

  /* Dashboard stats */
  #dashboardStats { display:flex; justify-content:center; gap:25px; flex-wrap:wrap; margin:20px 0; }
  .stat-card { background:#fff; padding:20px 30px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1); text-align:center; flex:1 1 200px; min-width:180px; transition: transform 0.2s, box-shadow 0.2s; cursor:pointer; }
  .stat-card:hover { transform:translateY(-5px); box-shadow:0 5px 15px rgba(0,0,0,0.15); }
  .stat-card h2 { font-size:2rem; color:#007bff; margin:0 0 8px; }
  .stat-card p { font-weight:600; margin:0; }

  /* Product grid */
  #productGrid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:20px; margin-bottom:30px; }
  .product { background:#fff; border-radius:8px; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,0.15); text-align:center; position:relative; }
  .product img { max-width:100%; height:140px; object-fit:contain; margin-bottom:10px; }
  .product h3 { margin:0 0 10px; }
  .product p { font-weight:bold; color:#007bff; margin-bottom:10px; }
  .btn { padding:8px 12px; margin:5px 3px; border:none; border-radius:4px; cursor:pointer; color:white; font-weight:600; }
  .btn-edit { background:#ffc107; color:#333; }
  .btn-delete { background:#dc3545; }
  #addProductBtn { background:#007bff; margin-bottom:20px; font-size:1rem; display:inline-block; }

  /* Product form */
  #productForm { background:#fff; padding:20px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); max-width:400px; margin:0 auto 30px auto; display:none; }
  #productForm label { display:block; margin-bottom:8px; font-weight:600; }
  #productForm input[type="text"], #productForm input[type="number"] { width:100%; padding:8px; margin-bottom:15px; border:1px solid #ccc; border-radius:4px; font-size:1rem; }
  #productForm input[type="file"] { margin-bottom:15px; }
  #productForm button { margin-right:10px; padding:10px 18px; font-size:1rem; border-radius:5px; border:none; cursor:pointer; }
  #submitProductBtn { background:#28a745; color:white; }
  #cancelProductBtn { background:#6c757d; color:white; }
</style>
</head>
<body>

<!-- Header -->
<header class="main-header">
  <div class="nav-container">
    <div class="logo-title">
      <img src="img/hi (1).png" alt="Futuree IT Solutions Logo" class="logo" />
      <span class="site-title">Futuree IT Solutions - Admin</span>
    </div>
    <nav role="navigation" aria-label="Main Navigation">
      <ul id="nav-links" class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="#" id="logoutBtn">Logout</a></li>
      </ul>
    </nav>
    <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="nav-links" id="menuToggleBtn">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<h1 style="text-align:center; margin-top:20px;">Admin Dashboard</h1>

<!-- Dashboard stats -->
<div id="dashboardStats">
  <div class="stat-card" id="totalProducts" onclick="scrollToSection('productGrid')">
    <h2 id="totalProductsCount">0</h2>
    <p>Total Products</p>
  </div>
  <div class="stat-card" id="totalOrders" onclick="navigateTo('orders.html')">
    <h2 id="totalOrdersCount">0</h2>
    <p>Total Orders</p>
  </div>
  <div class="stat-card" id="totalUsers" onclick="navigateTo('users.html')">
    <h2 id="totalUsersCount">0</h2>
    <p>Total Users</p>
  </div>
</div>

<!-- Product Management -->
<button id="addProductBtn" class="btn">Add New Product</button>
<form id="productForm">
  <label for="productName">Product Name</label>
  <input type="text" id="productName" required />
  <label for="productPrice">Price (R)</label>
  <input type="number" id="productPrice" step="0.01" min="0" required />
  <label for="productImage">Product Image</label>
  <input type="file" id="productImage" accept="image/*" />
  <button type="submit" id="submitProductBtn">Save Product</button>
  <button type="button" id="cancelProductBtn">Cancel</button>
</form>

<div id="productGrid"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey:"AIzaSyD2lyHJnzCJ3SQ_F0c6fI93x9zQ44ctqTc",
  authDomain:"login-auth-d702f.firebaseapp.com",
  projectId:"login-auth-d702f",
  storageBucket:"login-auth-d702f.appspot.com",
  messagingSenderId:"562569000961",
  appId:"1:562569000961:web:0952a9f12b6b8a6c1e6800"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentUser = null;
let editingProductId = null;

const productGrid = document.getElementById("productGrid");
const productForm = document.getElementById("productForm");
const addProductBtn = document.getElementById("addProductBtn");
const productNameInput = document.getElementById("productName");
const productPriceInput = document.getElementById("productPrice");
const productImageInput = document.getElementById("productImage");
const submitProductBtn = document.getElementById("submitProductBtn");
const cancelProductBtn = document.getElementById("cancelProductBtn");
const logoutBtn = document.getElementById("logoutBtn");

// Auth + live dashboard stats
auth.onAuthStateChanged(async user => {
  if (!user) { window.location.href="login.html"; return; }
  const userDoc = await db.collection("users").doc(user.uid).get();
  if (!userDoc.exists || userDoc.data().role!=="admin") { alert("Access denied."); window.location.href="login.html"; return; }
  currentUser=user;

  // Live stats
  db.collection("products").onSnapshot(snap=>{ document.getElementById("totalProductsCount").textContent=snap.size; loadProducts(); });
  db.collection("orders").onSnapshot(snap=>{ document.getElementById("totalOrdersCount").textContent=snap.size; });
  db.collection("users").onSnapshot(snap=>{ document.getElementById("totalUsersCount").textContent=snap.size; });
});

logoutBtn.onclick = ()=> auth.signOut().then(()=> location.href="index.html");

// Load products
async function loadProducts(){
  productGrid.innerHTML="Loading...";
  const snapshot = await db.collection("products").get();
  const products = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
  renderProducts(products);
}

function renderProducts(products){
  if(!products.length){ productGrid.innerHTML="<p>No products found.</p>"; return; }
  productGrid.innerHTML="";
  products.forEach(product=>{
    const div=document.createElement("div");
    div.className="product";
    div.innerHTML=`
      <img src="${product.image||'https://via.placeholder.com/150'}" alt="${product.name}" />
      <h3>${product.name}</h3>
      <p>R${Number(product.price).toFixed(2)}</p>
      <label style="display:block; margin-bottom:10px; font-weight:600;">
        Available:
        <input type="checkbox" class="availability-toggle" ${product.available ? 'checked' : ''} />
      </label>
      <button class="btn btn-edit"><i class="fas fa-edit"></i> Edit</button>
      <button class="btn btn-delete"><i class="fas fa-trash"></i> Delete</button>
    `;

    div.querySelector(".btn-edit").addEventListener("click",()=>startEditProduct(product.id));
    div.querySelector(".btn-delete").addEventListener("click",()=>deleteProduct(product.id));
    div.querySelector(".availability-toggle").addEventListener("change", async e=>{
      const available = e.target.checked;
      await db.collection("products").doc(product.id).update({available});
    });

    productGrid.appendChild(div);
  });
}

addProductBtn.onclick=()=>{ editingProductId=null; productForm.reset(); productForm.style.display="block"; productForm.scrollIntoView({behavior:"smooth"}); };
cancelProductBtn.onclick=()=>{ productForm.style.display="none"; editingProductId=null; };

productForm.onsubmit=async e=>{
  e.preventDefault();
  const name=productNameInput.value.trim();
  const price=parseFloat(productPriceInput.value);
  const file=productImageInput.files[0];
  if(!name||isNaN(price)||price<0) return alert("Enter valid name and price.");
  submitProductBtn.disabled=true;
  submitProductBtn.textContent=editingProductId?"Updating...":"Saving...";

  try{
    let imageUrl=null;
    if(file){ const fileRef=storage.ref(`product_images/${Date.now()}_${file.name}`); await fileRef.put(file); imageUrl=await fileRef.getDownloadURL(); }

    if(editingProductId){
      const updateData={name,price}; if(imageUrl) updateData.image=imageUrl;
      await db.collection("products").doc(editingProductId).update(updateData);
      alert("Product updated.");
    }else{
      await db.collection("products").add({
        name,
        price,
        image:imageUrl||'https://via.placeholder.com/150',
        available: true
      });
      alert("Product added.");
    }
    productForm.style.display="none";
  }catch(err){ alert("Error: "+err.message); }
  finally{ submitProductBtn.disabled=false; submitProductBtn.textContent="Save Product"; }
};

async function startEditProduct(id){
  const doc=await db.collection("products").doc(id).get();
  if(!doc.exists) return alert("Product not found.");
  const product=doc.data();
  editingProductId=id;
  productForm.style.display="block";
  productNameInput.value=product.name;
  productPriceInput.value=product.price;
  productForm.scrollIntoView({behavior:"smooth"});
}

async function deleteProduct(id){
  if(!confirm("Delete this product?")) return;
  await db.collection("products").doc(id).delete();
}

// Mobile menu toggle
const menuToggleBtn=document.getElementById('menuToggleBtn');
const navLinks=document.getElementById('nav-links');
menuToggleBtn.addEventListener('click', e=>{ e.stopPropagation(); navLinks.classList.toggle('open'); });
document.addEventListener('click', e=>{ if(!navLinks.contains(e.target)&&!menuToggleBtn.contains(e.target)){ navLinks.classList.remove('open'); } });
function scrollToSection(id){ document.getElementById(id)?.scrollIntoView({behavior:"smooth"}); }
function navigateTo(url){ window.location.href=url; }
</script>
</body>
</html>
